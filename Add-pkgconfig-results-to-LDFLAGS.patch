From 53809e5d2b37c059fb188fadbf6dcf72930b806c Mon Sep 17 00:00:00 2001
From: Martin Guenther <martin.guenther@dfki.de>
Date: Thu, 15 Sep 2016 15:00:40 +0200
Subject: [PATCH] Add pkgconfig results to LDFLAGS

Without this patch, the linker doesn't find `-lprotobuf` when protobuf
is installed to a location that is not on the linker's default search
path.
---
 Makefile                    | 1 +
 templates/Makefile.template | 1 +
 2 files changed, 2 insertions(+)

diff --git a/Makefile b/Makefile
index af4d4f48627..22ab44f5935 100644
--- a/Makefile
+++ b/Makefile
@@ -746,6 +746,7 @@ ifneq ($(LDFLAGS_PROTOBUF_PKG_CONFIG),)
 LDFLAGS_PROTOBUF_PKG_CONFIG += $(shell $(PKG_CONFIG) --libs-only-L protobuf | sed s/L/Wl,-rpath,/)
 endif
 endif
+LDFLAGS := $(LDFLAGS_PROTOBUF_PKG_CONFIG) $(LDFLAGS)
 else
 PC_LIBS_GRPCXX = -lprotobuf
 endif
diff --git a/templates/Makefile.template b/templates/Makefile.template
index e6a28d16bce..c32f70f9632 100644
--- a/templates/Makefile.template
+++ b/templates/Makefile.template
@@ -640,6 +640,7 @@
   LDFLAGS_PROTOBUF_PKG_CONFIG += $(shell $(PKG_CONFIG) --libs-only-L protobuf | sed s/L/Wl,-rpath,/)
   endif
   endif
+  LDFLAGS := $(LDFLAGS_PROTOBUF_PKG_CONFIG) $(LDFLAGS)
   else
   PC_LIBS_GRPCXX = -lprotobuf
   endif
